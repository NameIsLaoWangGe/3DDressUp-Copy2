{
  "code": "import Behaviour from \"./Behaviour\";\r\nimport PromoItem from \"./PromoItem\";\r\nimport { GO } from \"../../GO\";\r\nexport default class P302 extends Behaviour {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.layoutsNode = null;\r\n        this.layouts = [];\r\n    }\r\n    get node() {\r\n        return this.owner;\r\n    }\r\n    async OnAwake() {\r\n        this.layoutsNode = this.node.getChildByName(\"lines\");\r\n        TJ.Develop.Yun.Promo.Data.ReportAwake(P302.style);\r\n        for (let i = 0; i < this.layoutsNode.numChildren; i++) {\r\n            this.layouts.push(this.layoutsNode.getChildAt(i).addComponent(P302Layout));\r\n        }\r\n        this.active = false;\r\n        let list = await TJ.Develop.Yun.Promo.Data.LoadList();\r\n        if (list != null && list.length > 0) {\r\n            let www = new TJ.Common.WWW(\"http://h5.tomatojoy.cn/res/659827d1-d6a0-8248-c5ec-849bda0841a5/promo/cftest.json\");\r\n            await www.Send();\r\n            if (www.text != null) {\r\n                let dic = JSON.parse(www.text);\r\n                for (let l = 0; l < this.layouts.length; l++) {\r\n                    if (l < dic.P302.length) {\r\n                        for (let i = 0; i < dic.P302[l].length; i++) {\r\n                            let data = list.find((item) => item.promoGuid == dic.P302[l][i]);\r\n                        }\r\n                        this.layouts[l].Init(this.node.width);\r\n                    }\r\n                    else {\r\n                        this.layouts[l].node.active = false;\r\n                    }\r\n                }\r\n                this.active = true;\r\n                TJ.Develop.Yun.Promo.Data.ReportStart(P302.style);\r\n            }\r\n            else {\r\n                this.owner.destroy();\r\n            }\r\n        }\r\n        else {\r\n            this.owner.destroy();\r\n        }\r\n    }\r\n    OnUpdate() {\r\n        this.layoutsNode.x -= .8;\r\n        for (let layout of this.layouts) {\r\n            if (layout.node.active) {\r\n                layout.Refresh(this.layoutsNode.x);\r\n            }\r\n        }\r\n    }\r\n}\r\nP302.style = \"P302\";\r\nclass P302Layout extends Behaviour {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.datas = [];\r\n        this.items = [];\r\n        this.prefab = null;\r\n    }\r\n    get node() {\r\n        return this.owner;\r\n    }\r\n    OnAwake() {\r\n        this.prefab = this.node.getChildAt(0);\r\n        this.prefab.active = this.prefab.visible = false;\r\n    }\r\n    Init(width) {\r\n        let mx = width / (this.prefab.width + 13);\r\n        mx = Math.ceil(mx) + 3;\r\n        let column = 0;\r\n        while (width >= this.prefab.width) {\r\n            width = width - this.prefab.width - 13;\r\n            column++;\r\n        }\r\n        column += 3;\r\n        for (let i = 0; i < column; i++) {\r\n            let item = GO.Instantiate(this.prefab).getComponent(PromoItem);\r\n            this.node.addChild(item.owner);\r\n            item.owner.active = item.owner.visible = true;\r\n            this.items.push(item);\r\n            item.onAwake();\r\n        }\r\n    }\r\n    Refresh(posX) {\r\n        let ic = this.items.length;\r\n        let dc = this.datas.length;\r\n        if (ic < 1)\r\n            return;\r\n        if (dc < 1)\r\n            return;\r\n        let space = this.prefab.width + 13;\r\n        let k = -posX / space;\r\n        k = Math.floor(k);\r\n        let k1 = Math.floor(k / ic) * ic, k2 = k < 0 ? (ic + k % ic) % ic : (k % ic);\r\n        let checkPos = (item, pid) => {\r\n            if (item.posId != pid) {\r\n                item.posId = pid;\r\n                item.owner.x = pid * space - this.prefab.width / 2;\r\n                pid -= 1;\r\n                let did = pid < 0 ? (dc + pid % dc) % dc : (pid % dc);\r\n                if (item.dataId != did) {\r\n                    item.dataId = did;\r\n                    item.data = this.datas[did];\r\n                    item.data.Load();\r\n                    item.DoLoad();\r\n                }\r\n            }\r\n        };\r\n        for (let i = 0; i < k2; i++) {\r\n            checkPos(this.items[i], k1 + ic + i);\r\n        }\r\n        for (let i = k2; i < ic; i++) {\r\n            checkPos(this.items[i], k1 + i);\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/3DDressUp/Copy2/3DDressUp_Laya2.9.0/src/TJ/Promo/script/Behaviour.ts",
    "D:/Game/project/3DDressUp/Copy2/3DDressUp_Laya2.9.0/src/TJ/Promo/script/PromoItem.ts",
    "D:/Game/project/3DDressUp/Copy2/3DDressUp_Laya2.9.0/src/TJ/GO.ts"
  ]
}
