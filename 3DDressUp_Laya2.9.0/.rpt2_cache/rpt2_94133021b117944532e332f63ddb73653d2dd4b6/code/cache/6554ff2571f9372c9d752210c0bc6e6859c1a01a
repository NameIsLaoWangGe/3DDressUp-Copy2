{
  "code": "import PromoItem from \"./PromoItem\";\r\nimport Behaviour from \"./Behaviour\";\r\nexport default class P202 extends Behaviour {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.promoList = null;\r\n        this.itemList = [];\r\n        this.scroll = null;\r\n        this.layout = null;\r\n        this.prefab = null;\r\n        this.paddingTop = 10;\r\n        this.paddingBottom = 10;\r\n        this.line = 0;\r\n        this.column = 0;\r\n        this.toTop = false;\r\n        this.showing = [];\r\n    }\r\n    async OnAwake() {\r\n        this.scroll = this.owner.getChildByName(\"scroll\");\r\n        this.layout = this.scroll.getChildByName(\"layout\");\r\n        this.prefab = this.layout.getCell(0);\r\n        let w = this.owner.width - this.paddingTop - this.paddingBottom;\r\n        while (w >= this.prefab.width) {\r\n            w = w - this.prefab.width - this.layout.spaceX;\r\n            this.column++;\r\n        }\r\n        TJ.Develop.Yun.Promo.Data.ReportAwake(P202.style);\r\n        this.active = false;\r\n        this.promoList = await TJ.Develop.Yun.Promo.List.Get(P202.style);\r\n        if (this.promoList.count > 0) {\r\n            TJ.Develop.Yun.Promo.Data.ReportStart(P202.style);\r\n            this.line = Math.ceil(this.promoList.count / this.column);\r\n            this.layout.repeatX = this.column;\r\n            this.layout.repeatY = this.line;\r\n            for (let i = 0; i < this.layout.cells.length; i++) {\r\n                let node = this.layout.getCell(i);\r\n                if (i < this.promoList.count) {\r\n                    let item = node.getComponent(PromoItem);\r\n                    if (item != null) {\r\n                        this.itemList.push(item);\r\n                        item.style = P202.style;\r\n                        item.onAwake();\r\n                    }\r\n                    Behaviour.SetActive(node, true);\r\n                }\r\n                else {\r\n                    Behaviour.SetActive(node, false);\r\n                }\r\n            }\r\n            this.line = Math.ceil(this.itemList.length / this.column);\r\n            let h = this.paddingTop + this.paddingBottom;\r\n            h += this.prefab.height * this.line + this.layout.spaceY * (this.line - 1);\r\n            this.layout.height = h;\r\n            if (this.scroll.height < this.layout.height) {\r\n                this.scroll.vScrollBarSkin = \"\";\r\n                this.scroll.vScrollBar.rollRatio = 0;\r\n            }\r\n            for (let item of this.itemList) {\r\n                this.LoadIcon(item);\r\n            }\r\n            this.active = true;\r\n        }\r\n        else {\r\n            this.owner.destroy();\r\n        }\r\n    }\r\n    async OnDisable() {\r\n        this.promoList = await TJ.Develop.Yun.Promo.List.Get(P202.style);\r\n        for (let item of this.itemList) {\r\n            this.LoadIcon(item);\r\n        }\r\n    }\r\n    get maxTop() {\r\n        return 0;\r\n    }\r\n    get maxBottom() {\r\n        let y = this.paddingTop + this.paddingBottom;\r\n        y += this.prefab.height * this.line + this.layout.spaceY * (this.line - 1) - this.scroll.height;\r\n        return y;\r\n    }\r\n    get scrollValue() {\r\n        if (this.scroll.vScrollBar != null) {\r\n            return this.scroll.vScrollBar.value;\r\n        }\r\n        return 0;\r\n    }\r\n    set scrollValue(v) {\r\n        if (this.scroll.vScrollBar != null) {\r\n            this.scroll.vScrollBar.value = v;\r\n        }\r\n    }\r\n    OnUpdate() {\r\n        let deltaTime = Laya.timer.delta / 1000;\r\n        if (this.scroll.height < this.layout.height) {\r\n            if (this.scrollValue <= this.maxTop) {\r\n                this.toTop = false;\r\n            }\r\n            else if (this.scrollValue >= this.maxBottom) {\r\n                this.toTop = true;\r\n            }\r\n            if (this.toTop) {\r\n                this.scrollValue -= 50 * deltaTime;\r\n            }\r\n            else {\r\n                this.scrollValue += 50 * deltaTime;\r\n            }\r\n        }\r\n        else {\r\n            this.scrollValue = this.maxTop;\r\n        }\r\n        this.CheckShow();\r\n    }\r\n    LoadIcon(promoItem) {\r\n        let data = this.promoList.Load();\r\n        if (data != null) {\r\n            this.promoList.Unload(promoItem.data);\r\n            promoItem.data = data;\r\n            promoItem.onClick_ = (item) => { this.LoadAndShowIcon(item); };\r\n            promoItem.DoLoad();\r\n            promoItem.infoText.text = 1 + Math.floor(Math.random() * 40) / 10 + \"w人在玩\";\r\n        }\r\n        return data;\r\n    }\r\n    LoadAndShowIcon(promoItem) {\r\n        if (this.LoadIcon(promoItem) != null) {\r\n            promoItem.OnShow();\r\n        }\r\n    }\r\n    CheckShow() {\r\n        for (let item of this.itemList) {\r\n            let i = this.showing.indexOf(item);\r\n            let node = item.owner;\r\n            let d = Math.abs(-node.y - this.paddingTop - this.prefab.height / 2 + this.scrollValue + this.scroll.height / 2);\r\n            if (d < this.scroll.height / 2) {\r\n                if (i < 0) {\r\n                    this.showing.push(item);\r\n                    item.OnShow();\r\n                }\r\n            }\r\n            else {\r\n                if (i >= 0) {\r\n                    this.showing.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nP202.style = \"P202\";\r\n",
  "references": [
    "D:/Game/project/3DDressUp/Copy/3DDressUp_Laya2.9.0/3DDressUp_Laya2.9.0/src/TJ/Promo/script/PromoItem.ts",
    "D:/Game/project/3DDressUp/Copy/3DDressUp_Laya2.9.0/3DDressUp_Laya2.9.0/src/TJ/Promo/script/Behaviour.ts"
  ]
}
